<!DOCTYPE html>
<html lang="en-us">

  <head>
	<link href="http://gmpg.org/xfn/11" rel="profile">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="description" content="Codoki is a web development and design
	blog about the latest trends in web technology.">

	<!-- Enable responsiveness on mobile devices-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <!-- REDIRECT -->
  <meta http-equiv="refresh" content="0; url=https://cdmedia.github.io/posts/2015-08-07-build-a-local-search-app-with-geo">
  <link rel="canonical" href="https://cdmedia.github.io/posts/2015-08-07-build-a-local-search-app-with-geo" />
	<title>
	
	Build a local search based app with geolocation &middot; Codoki
	
	</title>

	<!-- CSS -->
	<link href="http://cdn.rawgit.com/noelboss/featherlight/1.0.4/release/featherlight.min.css" type="text/css" rel="stylesheet" title="Featherlight Styles" />
	<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
	<link rel="stylesheet" href="../../../../public/css/poole.css">
	<link rel="stylesheet" href="../../../../public/css/monokai.css">
	<link rel="stylesheet" href="../../../../public/css/lanyon.css">
	<link rel="stylesheet" href="../../../../public/css/codoki.css">

	<!-- Icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../../public/apple-touch-icon-precomposed.png">
	<link rel="shortcut icon" href="../../../../public/favicon.ico">

	<!-- JS -->
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="http://cdn.rawgit.com/noelboss/featherlight/1.0.4/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../../../public/js/modernizr.custom.js"></script>
	<script src="../../../../public/js/classie.js"></script>
	<script src="../../../../public/js/search.js"></script>
	<script src="../../../../public/js/script.js"></script>

	<!-- RSS -->
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://codoki.com/atom.xml">
</head>


  <body class="layout">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="../../../../index.html">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="../../../../archive/index.html">Archive</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="../../../../learning/index.html">Learning Resources</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="../../../../links/index.html">Links</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    

	    <a class="sidebar-nav-item" href="../../../../resources.html">News/Inspiration</a>
	    <a class="sidebar-nav-item" href="../../../../about.html">About</a>
	    <a class="sidebar-nav-item" href="../../../../subscribe.html"><i class="fa fa-envelope-o"></i> Subscribe</a>

	    <!--<span class="sidebar-nav-item"></span>-->
    </nav>
  </div>
</div>



    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
    <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a class="logo-wrap" href="../../../../index.html" title="Home">
			  <img class="logo logo" src="../../../../public/img/codoki-logo2.png" />
			 </a>
            <a class="title" href="../../../../index.html" title="Home">Codoki</a>
            <small>Tutorials, resources and tips for Web Developers</small>
          </h3>
        </div>
      </div>

       <a href="index.html#" id="trigger-overlay"><i class="fa fa-search fa-lg search-icon"></i></a>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Build a local search based app with geolocation</h1>
  <span class="post-date">07 Aug 2015
	<ul class="tag_list_in_post">
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#javascript">javascript</a>
		</li>
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#geolocation">geolocation</a>
		</li>
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#app.js">app.js</a>
		</li>
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#yahoo YQL">yahoo YQL</a>
		</li>
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#mobile">mobile</a>
		</li>
	
		<li class="inline tag_list_item">
			<a class="tag_list_link" href="../../../../tags.1.html#webapp">webapp</a>
		</li>
	
	<p id="post-meta"></p>
	</ul>
  </span>
  <p>Use native browser based geolocation and Yahoo&#39;s YQL to build a local search based webapp.</p>

<hr>

<p>In this tutorial, we will be building a local search based app with geolocation
(using <a href="https://developer.yahoo.com/yql/console/">Yahoo&#39;s YQL</a> API). We will be
using the user search term to query against Yahoo&#39;s API and get the right local
data back.</p>

<h3>1. Picking A Mobile Javascript Framework</h3>

<p>I&#39;ve been on the hunt for a lightweight javascript mobile app framework for
sometime. Some of the contenders included
<a href="http://www.idangero.us/framework7">Framework7</a>, <a href="http://codoki.com/2015/08/07/build-a-local-search-app-with-geo/ionicframework.com/">Ionic</a>,
<a href="http://jquerymobile.com/">jQuery Mobile</a>, <a href="http://lungo.tapquo.com/">Lungo</a> and
<a href="http://mobileangularui.com/">Mobile Angular UI</a> which are ALL great options in
my opinion...but I wanted something super-lightweight with a minimal footprint.
I came across <a href="http://code.kik.com/app/">App.js</a> by Kik (yep the same company
who brought you Kik Messenger). App.js seemed to fit all the criteria I was
looking for--lightweight, native-like interactions and easily customizable.</p>

<p>With App.js, you can get a mobile webapp up in running in no time at all. The
best part is, you can use just Javascript, CSS and HTML to have an almost
native-like experience on basic apps.</p>

<p><strong>Side note</strong>
If you want a &quot;more comprehensive&quot; framework, pick something like <a href="http://codoki.com/2015/08/07/build-a-local-search-app-with-geo/ionicframework.com/">Ionic</a>. App.js
is a great framework for light, minimal apps but if you want to build something more
robust, Ionic has a great following and plenty of native feature support.</p>

<h3>2. Setup App.js template</h3>

<p>Kik does provide a nice App.js starter template, but you can skip a few extra
steps and clone my version. This way you don&#39;t have to worry about setting up
the javscript and css files.</p>
<div class="highlight"><pre><code class="language-" data-lang="">git clone git@github.com:cdmedia/appjs-starter-kit.git
</code></pre></div>
<p>This is a great starting point for the app. Visit the project on your localhost and
you can play around with all the nice features App.js includes like stack management, page transitions, and UI
components.</p>

<h3>3. Add Font Awesome</h3>

<p>We are going to add one more stylesheet to our <code>index.html</code> template. Just below the reference to <code>app.min.css</code> add:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"</span><span class="nt">&gt;</span></code></pre></figure>

<h3>4. Add our styling</h3>

<p>In your <code>css/style.css</code> file add the following code. I won&#39;t bother to go
through all the CSS, but just know this will help clean up some things down the
line.</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.list-distance</span> <span class="p">{</span>
  <span class="nl">float</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#AFAFAF</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-page</span> <span class="nc">.placeholder.active</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-button</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
  <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-page</span> <span class="nc">.placeholder</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#999</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">-55px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-page</span> <span class="nc">.placeholder</span> <span class="nt">span</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span> <span class="m">16px</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">65px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">65px</span><span class="p">;</span>
  <span class="nl">-webkit-background-size</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">background-size</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">background-repeat</span><span class="p">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
  <span class="nl">background-position</span><span class="p">:</span> <span class="nb">center</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">content</span><span class="p">:</span> <span class="s1">"\f002"</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="n">FontAwesome</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-page</span> <span class="nc">.loader</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#999</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">-55px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.app-page</span> <span class="nc">.loader</span> <span class="nt">i</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#999</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">span</span><span class="nc">.rating-stars</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">180</span><span class="p">,</span> <span class="m">180</span><span class="p">,</span> <span class="m">66</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">span</span><span class="nc">.no-ratings</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#6A6767</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">span</span><span class="nc">.latest-review-date</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">12px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#7C7C7C</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">p</span><span class="nc">.latest-review</span> <span class="p">{</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">italic</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h3>5. Add our list view template</h3>

<p>Open up your <code>index.html</code> file. Now just remove everything in the <code>&lt;body&gt;</code> tags and paste in this as a starting point.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-page"</span> <span class="na">data-page=</span><span class="s">"listView"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-topbar blue"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-title"</span><span class="nt">&gt;</span>My Local App<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-content"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">""</span><span class="nt">&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"search"</span> <span class="na">class=</span><span class="s">"app-input no-icon-android"</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">placeholder=</span><span class="s">"Search..."</span><span class="nt">&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"results"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"placeholder search"</span><span class="nt">&gt;&lt;span&gt;&lt;/span&gt;</span>Search for something local...<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"loader"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-spinner fa-spin fa-3x"</span><span class="nt">&gt;&lt;/i&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/zepto.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/app.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure>

<p>What we have done here is created an app.js <code>data-page</code> for our <code>listView</code> which will
display a list of local suggestions based on our search query. App.js allows these data pages
to &quot;stack&quot; ontop of one another, similar to native mobile applications.</p>

<p>We can place all our content in the <code>&lt;div class=&quot;app-content&quot;&gt;</code>. In there you can
see we have a simple search form we will use to get the user&#39;s search query. Just below
is the <code>&lt;div class=&quot;results&quot;&gt;</code> div which is where our search results will populate. We also
threw in a nice Font Awesome spinning loader which will show the user that the app is &quot;thinking&quot;
(give the app enough time to submit a YQL query without the user losing interest or think it&#39;s broken).</p>

<h3>6. Setting up the Javascript</h3>

<p>Now that we have our list view template made, we can start to get this app working.
Open up your <code>js/app.js</code> file and delete whatever is in there. We will go through step by step.</p>

<p><em>Side-note</em> : There will be lots of <code>console.log()</code> sprinkled throughout the source to make sure everything&#39;s running smoothly. Feel free to remove or
ignore these (I actually suggest removing all of them completely after you are done building as they are memory hogs).</p>

<p>First thing we will do is create a controller for our list view and then init our app to load
the list view on initial load state:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'listView'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Ready'</span><span class="p">);</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'listView'</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Now if you visit your index.html in your browser, you should see the console logged with &#39;Ready&#39;.</p>

<h3>7. Geolocation</h3>

<p>Next step is to get the user&#39;s location. Luckily, Javascript <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation">already has a built in API</a> for
getting a user&#39;s location so we don&#39;t have to rely on any outside libraries for this.</p>

<p>First, let&#39;s declare some geo variables that we will be using later. At the top of your
<code>js/app.js</code> file before your <code>App.controller(...</code>, add:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">geoAvailable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">geoData</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">geoPlace</span> <span class="o">=</span> <span class="p">[];</span></code></pre></figure>

<p>Next, we are going to check to make sure that the browser supports the geolocation API
and if it doesn&#39;t, throw an app.js pop up error. Just below the previous variables add:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="s2">"geolocation"</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">geoAvailable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">geoAvailable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>
      <span class="na">title</span>        <span class="p">:</span> <span class="s1">'Geolocation Error'</span><span class="p">,</span>
      <span class="na">text</span>         <span class="p">:</span> <span class="s1">'Looks like we cannot find you. Please upgrade to a newer browser'</span><span class="p">,</span>
      <span class="na">okButton</span>     <span class="p">:</span> <span class="s1">'OK'</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>Also, just below your gelocation check we are going to hide the search placeholder:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'.placeholder'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span></code></pre></figure>

<p>Now that we have made sure we can use geolocation, let&#39;s start using it. We are going to
create a getGeolocation function that will return the current position. Just below the <code>$(&#39;.placeholder&#39;).hide();</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*
 * Get geolocation
 */</span>
<span class="kd">function</span> <span class="nx">getGeolocation</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">geoData</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
        <span class="c1">//getGeoPlace(position); // Get zip code using position from geolocation</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">position</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">PERMISSION_DENIED</span><span class="err">:</span>
                <span class="nx">App</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>
                    <span class="na">title</span>        <span class="p">:</span> <span class="s1">'Geolocation Error'</span><span class="p">,</span>
                    <span class="na">text</span>         <span class="p">:</span> <span class="s1">'Looks like we cannot find you. Please enable location services for this site.'</span><span class="p">,</span>
                    <span class="na">okButton</span>     <span class="p">:</span> <span class="s1">'OK'</span>
                <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">POSITION_UNAVAILABLE</span><span class="err">:</span> <span class="nx">alert</span><span class="p">(</span><span class="s2">"could not detect current position"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">TIMEOUT</span><span class="err">:</span>
                <span class="nx">App</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>
                    <span class="na">title</span>        <span class="p">:</span> <span class="s1">'Geolocation Error'</span><span class="p">,</span>
                    <span class="na">text</span>         <span class="p">:</span> <span class="s1">'Retrieving position timeout. Please try reloading the page.'</span><span class="p">,</span>
                    <span class="na">okButton</span>     <span class="p">:</span> <span class="s1">'OK'</span>
                <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="nl">default</span><span class="p">:</span> <span class="nx">alert</span><span class="p">(</span><span class="s2">"unknown error"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="p">{</span><span class="na">timeout</span><span class="p">:</span><span class="mi">10000</span><span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>Let&#39;s break down what&#39;s going on in this function. You can see we have 2 function variables declared: success and error
along with the Javascript function to get the current geolocaton. We call the <code>window.navigator.geolocation.getCurrentPosition()</code> function
with our variables as parameters to handle success and error.</p>

<p>On successful geolocation, we return the current position. In addition, we will also push the current position to our <code>geoData</code> array for use later on.
We also have a <code>getGeoPlace()</code> function where we are calling with the return position...
but we will get to this later so don&#39;t worry about that right now (notice it&#39;s commented out).</p>

<p>On geolocation error, we call App.js pop-up dialogs with a few suggestions to the user on how to fix
the problem.</p>

<p><strong>Note:</strong>  If a user DOES end up denying location access, the only way to fix this is for the
user to open their browser location settings and change them on their own...there&#39;s no way
to force the user to give their location.</p>

<p>Now remove the <code>console.log</code> and call the function inside our <code>listView</code> controller:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'listView'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Get initial geolocation for search</span>
  <span class="nx">getGeolocation</span><span class="p">();</span>
<span class="p">});</span></code></pre></figure>

<p>If you refresh your index.html, you should now see your geolocation logged in the javascript console.</p>

<h3>8. Yahoo YQL</h3>

<p>Great we now have our geo coordinates, but now what? Luckily, there are plenty of APIs in
which you can utilize geolocation. We are going to take advantage of <a href="https://developer.yahoo.com/yql/console/">Yahoo&#39;s YQL</a>, a query
language with all kinds of goodies and data to play with.</p>

<p>YQL is structured similar to SQL, so querys can be easily written and understood. For our local search app,
we are going to be querying 2 tables in Yahoo&#39;s database: Geo place and local search (as we need to get
geo place in order to build a local search query).</p>

<p>We will start off with a generic YQL query function we can use for both. Add this just above your
<code>getGeolocation()</code> function:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// YQL serves JSONP (with a callback) so all we have to do</span>
<span class="c1">// is create a script element with the right 'src':</span>
<span class="kd">function</span> <span class="nx">YQLQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">query</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="nx">callback</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(){};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'YQLQuery.fetch(): Parameters may be undefined'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">scriptEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">),</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="s1">'yql'</span> <span class="o">+</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
            <span class="nx">encodedQuery</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()),</span>
            <span class="nx">instance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">YQLQuery</span><span class="p">[</span><span class="nx">uid</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">instance</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
            <span class="k">delete</span> <span class="nx">YQLQuery</span><span class="p">[</span><span class="nx">uid</span><span class="p">];</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">scriptEl</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="nx">scriptEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'https://query.yahooapis.com/v1/public/yql?q='</span>
                     <span class="o">+</span> <span class="nx">encodedQuery</span> <span class="o">+</span> <span class="s1">'&amp;format=json&amp;callback=YQLQuery.'</span> <span class="o">+</span> <span class="nx">uid</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">scriptEl</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></figure>

<p>This function accepts a YQL query statement and a callback in order to run after
a successful query.</p>

<p>The goal of this app is to get local interests based on location but Yahoo&#39;s YQL Query for
getting local items doesn&#39;t allow us to just pass in geolocation coordinates. In order to get
local interest, we need to get the &quot;Geo Place&quot; first (aka zipcode or area). We will query Yahoo&#39;s YQL
with our geolocation coordinates to the geo place. Once we get the geo place, we will be able to retreive local interests.</p>

<p>Let&#39;s build a function to get our geo place based on our geolocation coordinates. Place this
above our <code>getGeolocation()</code> function and make sure to uncomment the <code>getGeoPlace(position);</code> inside
our <code>getGeolocation()</code> function as well:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*
 * Get geo place location based on Yahoo YQL
 * @position Navigator geolocation object
 */</span>
<span class="kd">function</span> <span class="nx">getGeoPlace</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">yPlace</span><span class="p">(</span><span class="nx">place</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">place</span> <span class="o">=</span> <span class="nx">place</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">place</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">yPlace</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">Result</span><span class="p">);</span>
        <span class="nx">geoPlace</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">place</span><span class="p">);</span> <span class="c1">// Store geoPlace data in geoData variable</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">place</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM geo.placefinder WHERE text="'</span> <span class="o">+</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span> <span class="o">+</span> <span class="s1">','</span> <span class="o">+</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span> <span class="o">+</span> <span class="s1">'" and gflags="R"'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">place</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YQLQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="nx">place</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>Here we are using the geolocation coordinates to create a YQL statement that will then be
passed into our <code>YQLQuery()</code> function. After that function has run, the <code>getGeoPlace()</code> callback
function is called that get&#39;s the result data and pushes it to the <code>geoPlace</code> array for later use.
Now when we perform our search based on a search query, we will have the geolocation and geo place
stored in variables.</p>

<p>Let&#39;s build one more function that will peform a search based on a user&#39;s inputted search
keyword. Add this just below <code>getGeoPlace()</code> function:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*
 * Perform a search based on input
 * @input Input value
 */</span>
<span class="kd">function</span> <span class="nx">performSearch</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span> <span class="c1">// Clean up spaces from the search query</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">blur</span><span class="p">();</span> <span class="c1">// Unfocus search input</span>
    <span class="c1">// Build YQL Search query</span>
    <span class="kd">var</span> <span class="nx">zipcode</span> <span class="o">=</span> <span class="nx">geoPlace</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">place</span><span class="p">.</span><span class="nx">uzip</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">'SELECT * FROM local.search(20) WHERE query="'</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s1">'" and location="'</span> <span class="o">+</span> <span class="nx">zipcode</span> <span class="o">+</span> <span class="s1">'"'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YQLQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">buildResults</span><span class="p">);</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Here we are taking the user&#39;s input text, trimming it to make sure there isn&#39;t any funky spacing, navigate
away from the input and then query. Similar to above, we are going to use the <code>YQLQuery()</code> function to query against
Yahoo&#39;s database, but this time to get local search results based on geo place. Notice, we only need the first
zipcode <code>geoPlace[0].place.uzip</code> since the user is in only one location at a time. Also, notice that our
callback for the <code>YQLQuery()</code> is <code>buildResults</code>. We will be getting to this next, but this will build all the results
after our <code>YQLQuery()</code> has run. Finally, we will call the YQLQuery&#39;s <code>.fetch()</code> to fetch the data from YQL.</p>

<p>In order to avoid any javascript errors, just below the <code>performSearch()</code> function add an empty
for our <code>YQLQuery()</code> from above.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*
 * Build results
 * @data YQL query data
 */</span>
<span class="kd">function</span> <span class="nx">buildResults</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Now let&#39;s plug that into our list view controller and see the magic happen:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'listView'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">getGeolocation</span><span class="p">();</span> <span class="c1">// Get initial geolocation for search</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'.loader'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span> <span class="c1">// Show loader while geo is working</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.loader'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.placeholder'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span> <span class="c1">// Give us a bit of time for the geolocation to work</span>
    <span class="c1">// Get HTML elements</span>
    <span class="kd">var</span> <span class="nx">form</span>        <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'form'</span><span class="p">),</span>
        <span class="nx">input</span>       <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'form .app-input'</span><span class="p">),</span>
        <span class="nx">placeHolder</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.placeholder'</span><span class="p">),</span>
        <span class="nx">resultTmpl</span>  <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.result'</span><span class="p">);</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="c1">// If user tries to search before geo is loaded</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">geoPlace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"undefined"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">App</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>
                    <span class="na">title</span>        <span class="p">:</span> <span class="s1">'Whooooah'</span><span class="p">,</span>
                    <span class="na">text</span>         <span class="p">:</span> <span class="s1">'Slow down there, sonny...we are still trying to figure out where you are. Try searching again.'</span><span class="p">,</span>
                    <span class="na">okButton</span>     <span class="p">:</span> <span class="s1">'OK'</span>
                <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">performSearch</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>Notice we&#39;ve added a few more things to this function. First, we are going to show the loader
while the app is working. We are also going to set a timeout function to give us a bit of time
when the user initially opens the app. This way, we can try and gather geolocation and geo place.
Next, we are going to grab all the template elements that we will need. Last, we will add an
event listener to check if the user submits a new search. If the user submits before geo is loaded, we
will throw a dialog error. Otherwise, we will peform a search based on the search input text.</p>

<p>Now try performing a search. You should be able to see all the local results populate your javascript console.</p>

<h3>9. Rendering the results</h3>

<p>Awesome. Now we have all the data, we just have to render it on the page. Luckily, we don&#39;t have to
do too much since App.js already looks pretty nice as it is. For the list view, all we really need
is the title of the place and how far away it is. Let&#39;s build a function that will render our results.
Just below <code>performSearch()</code>, replace the <code>buildResults()</code> function from above with this:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*
 * Build results
 * @data YQL query data
 */</span>
<span class="kd">function</span> <span class="nx">buildResults</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">Result</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">resultCount</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">location</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">City</span> <span class="o">+</span> <span class="s1">', '</span> <span class="o">+</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">State</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="s1">'&lt;ul class="app-list"&gt;&lt;label&gt;Displaying '</span> <span class="o">+</span> <span class="nx">resultCount</span> <span class="o">+</span> <span class="s1">' results near '</span> <span class="o">+</span> <span class="nx">location</span> <span class="o">+</span> <span class="s1">'&lt;/label&gt;&lt;/ul&gt;'</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'.placeholder'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span> <span class="c1">// Hide placeholder</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'.loader'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.loader'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="c1">// Build results list</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.results'</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'.results'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">val</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">listContent</span> <span class="o">=</span> <span class="s1">'&lt;li class="result-item-'</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'"&gt;'</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">Title</span> <span class="o">+</span> <span class="s1">'&lt;span class="list-distance"&gt;'</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">Distance</span> <span class="o">+</span> <span class="s1">' m&lt;/span&gt;&lt;/li&gt;'</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'.app-list'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">listContent</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'.result-item-'</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="nx">App</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'detailView'</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>In this function we will insert our data into our template. First, we will set up a few variables
based on our input data (result data from YQL). We will then add a small label below the
title displaying the city, state and result count. Then, we will hide the results placeholder and show
the loader while the query processes. We then set a timeout to give the YQLQuery a little bit time to process
in which we hide the loader, empty out the results div (on each new search), and then append items to
the results container using our YQL data. One more thing to note: we also add a unique id to each
result item in order to build out a &quot;detail view&quot; later. Here we will add a click event for later use
to load the &#39;detailView&#39; and pass in the individual items&#39; data with <code>App.load(&#39;detailView&#39;, val)</code>.</p>

<p>Now when you peform a search, results should populate in the results area. Try searching &quot;pizza&quot;.</p>

<h3>9. Building the detail view</h3>

<p>Now that we have a list view of local items, we need to have a way for the user to
get more information, call or get the address. First let&#39;s create a template in our <code>index.html</code>.
Add this just after the <code>&lt;div class=&quot;app-page&quot; data-page=&quot;listView&quot;&gt;&lt;/div&gt;</code> div node.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-page"</span> <span class="na">data-page=</span><span class="s">"detailView"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-topbar blue"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-button left"</span> <span class="na">data-back</span> <span class="na">data-autotitle</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-title"</span><span class="nt">&gt;</span>Details<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-section"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;&lt;/h3&gt;</span>
      <span class="nt">&lt;div&gt;&lt;span</span> <span class="na">class=</span><span class="s">"address"</span><span class="nt">&gt;&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"city-state"</span><span class="nt">&gt;&lt;/span&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;&lt;span</span> <span class="na">class=</span><span class="s">"distance"</span><span class="nt">&gt;&lt;/span&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;&lt;span</span> <span class="na">class=</span><span class="s">"phone"</span><span class="nt">&gt;&lt;/span&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;&lt;span</span> <span class="na">class=</span><span class="s">"rating-stars"</span><span class="nt">&gt;&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"no-ratings"</span><span class="nt">&gt;&lt;/span&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-section"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-button blue"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"call"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-phone"</span><span class="nt">&gt;&lt;/i&gt;</span> Call<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-button green"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"directions"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-map-marker"</span><span class="nt">&gt;&lt;/i&gt;</span> Get Directions<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"app-button orange"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"website"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-laptop"</span><span class="nt">&gt;&lt;/i&gt;</span> Website<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"review-section"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p>Here we are creating another app page called &quot;detailView&quot;. In the <code>&lt;div class=&quot;app-content&quot;&gt;</code>, we
have some blank divs and spans which will be populated once the app data comes in.</p>

<p>Now let&#39;s create a controller for our detail view. Just below the <code>App.controller(&#39;listView&#39;, function (page)...</code>
function add:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">App</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'detailView'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span> <span class="o">=</span> <span class="s1">'rotate-right'</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.title'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Title</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.address'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Address</span> <span class="o">+</span> <span class="s1">' '</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.city-state'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">City</span> <span class="o">+</span> <span class="s1">', '</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">State</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.distance'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Distance</span> <span class="o">+</span> <span class="s1">' miles away'</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.phone'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Phone</span><span class="p">);</span>

    <span class="c1">// Ratings</span>
    <span class="kd">var</span> <span class="nx">numberOfRatings</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Rating</span><span class="p">.</span><span class="nx">TotalRatings</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">averageRating</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Rating</span><span class="p">.</span><span class="nx">AverageRating</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">numberOfRatings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="c1">// Good stars</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">averageRating</span><span class="p">){</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.rating-stars'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;i class="fa fa-star"&gt;&lt;/i&gt;'</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.rating-stars'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;i class="fa fa-star-o"&gt;&lt;/i&gt;'</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.no-ratings'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">' ('</span> <span class="o">+</span> <span class="nx">numberOfRatings</span> <span class="o">+</span> <span class="s1">' Ratings)'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Reviews</span>
    <span class="kd">var</span> <span class="nx">totalReviews</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Rating</span><span class="p">.</span><span class="nx">TotalReviews</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">latestReviewDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Rating</span><span class="p">.</span><span class="nx">LastReviewDate</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">latestReview</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Rating</span><span class="p">.</span><span class="nx">LastReviewIntro</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">totalReviews</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.review-section'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;div class="app-section"&gt;&lt;h4&gt;'</span> <span class="o">+</span> <span class="nx">totalReviews</span> <span class="o">+</span> <span class="s1">' Reviews&lt;/h4&gt;&lt;div&gt;&lt;span class="latest-review-date"&gt;'</span> <span class="o">+</span> <span class="nx">latestReviewDate</span> <span class="o">+</span> <span class="s1">'&lt;/span&gt;&lt;p class="latest-review"&gt;'</span> <span class="o">+</span> <span class="nx">latestReview</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Update links</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.call'</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">,</span> <span class="s1">'tel:'</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">MapPhone</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.directions'</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">MapUrl</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span> <span class="s2">"_blank"</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">page</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.website'</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">BusinessUrl</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span> <span class="s2">"_blank"</span><span class="p">);</span>

<span class="p">});</span></code></pre></figure>

<p>Now onto the detail view controller. Notice that we have <code>data</code> as an additional parameter in the
<code>App.controller()</code>. This is where the geo place detail data will be entering into the function
(seen in the <code>buildResults()</code> function as <code>App.load(&#39;detailView&#39;, val)</code>). We will then use an App.js transition to define a nice rotate
transition into our view. Next, we will find the basic HTML elements and add in the right data based on
the appropriate field using App.js <code>$(page).find()</code> function. Now onto the rating section: Here we will parse the data into integars
(since they come in as strings) and make sure there are some ratings. If there are, we will
display open/closed stars based on the rating. Then in the reviews section, we parse the
number of reviews and last review date. If there are reviews, we&#39;ll add the data to the
HTML. Last, we will update the contact links with the associated geo place.</p>

<h3>Conclusion</h3>

<p><img src="https://raw.githubusercontent.com/codoki/codoki.github.io/master/public/img/tuts/loclii-demo.gif" alt="Local Search App"></p>

<p>There you have it, we have built a local search web app w/ geolocation using Yahoo&#39;s YQL.
You can view the full source on <a href="https://github.com/cdmedia/loclii">github</a> or see a working <a href="http://cdmedia.github.io/loclii">demo here</a>.
Please feel free to leave questions/comments/suggestions!</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="../../../../2016/01/20/getting-started-with-react-js/index.html">
            Getting Started with React.js - Concepts and Creating Your First App
            <small>20 Jan 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="../../../09/01/native-javascript-templating/index.html">
            Native Javascript Templating - Goodbye Handlebars
            <small>01 Sep 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="../../../07/06/simplestore/index.html">
            simpleStore - Open-source online store with no database or backend
            <small>06 Jul 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>

  <hr>
  <h2>Popular Posts</h2>
   <ul class="related-posts popular">
   		<li><h3><a href="../../../01/27/getting-started-with-slim-framework/index.html">Getting Started with Slim Framework - Creating a RESTful API</a></h3></li>
      	<!--<li><h3><a href="/2015/08/07/build-a-local-search-app-with-geo/">Build a local search based app with geolocation</a></h3></li>-->
      	<li><h3><a href="../../../07/06/simplestore/index.html">simpleStore - Open-source online store with no database or backend</a></h3></li>
  </ul>

  <div class="updates">
    <hr>
    <!--<span>Want updates? <a href="http://eepurl.com/bpduc5" data-featherlight data-featherlight-type="iframe">Subscribe to get the latest goodies</a></span>-->
	<!-- Begin MailChimp Signup Form -->
	<link href="http://cdn-images.mailchimp.com/embedcode/classic-081711.css" rel="stylesheet" type="text/css">
	<style type="text/css">
		#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		#mc_embed_signup form { padding: 0px 0 0px 0%; }
	</style>
	<div id="mc_embed_signup">
	<form action="http://saturnbit.us10.list-manage.com/subscribe/post?u=6a958cda028d0d312d1ef3ccd&amp;id=4ee23b7fda" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
		<h2>Want Updates?</h2>
	<div class="mc-field-group">
		<label for="mce-EMAIL">Email Address </label>
		<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	</div>
		<div id="mce-responses" class="clear">
			<div class="response" id="mce-error-response" style="display:none"></div>
			<div class="response" id="mce-success-response" style="display:none"></div>
		</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;"><input type="text" name="b_6a958cda028d0d312d1ef3ccd_4ee23b7fda" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	</form>
	</div>
	<script type='text/javascript' src='http://s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	<!--End mc_embed_signup-->
  </div>
</div>

      	
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'cdianamedia'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
	 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

   <!-- Full screen search overlay - open/close -->
    <div class="overlay overlay-hugeinc">
      <button type="button" class="overlay-close"><i class="fa fa-close"></i></button>
      <div class="search-container">
        <input id="search-input" placeholder="Search..." />
        <div id="results-container"></div>
      </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67203123-1', 'auto');
  ga('send', 'pageview');

</script>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
